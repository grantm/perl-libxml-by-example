

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A Basic Example &mdash; Perl XML::LibXML by Example  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/plxbe.css" type="text/css" />
  

  
    <link rel="top" title="Perl XML::LibXML by Example  documentation" href="index.html"/>
        <link rel="next" title="XPath Expressions" href="xpath.html"/>
        <link rel="prev" title="Perl XML::LibXML by Example" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Perl XML::LibXML by Example
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">A Basic Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#other-xml-sources">Other XML sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-more-complex-example">A more complex example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-attributes">Accessing attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#attributes-via-tied-hash">Attributes via tied hash</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing-errors">Parsing Errors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="xpath.html">XPath Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="dom.html">The Document Object Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="namespaces.html">Working with XML Namespaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="large-docs.html">Working With Large Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="html.html">Working with HTML</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installing XML::LibXML</a></li>
</ul>

            
          
        </div><div class="custom-sidebar">
  <h3>Project Source</h3>
  <ul>
    <li><a href="https://github.com/grantm/perl-libxml-by-example">Project
    repository on GitHub</a></li>
    <li class="cc-img"><a rel="license" title="Creative Commons Attribution-ShareAlike License" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons CC-BY-SA License" style="border-width:0" src="_static/cc-by-sa.png" /></a></li>
  </ul>
</div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Perl XML::LibXML by Example</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>A Basic Example</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="_sources/basics.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-basic-example">
<h1>A Basic Example<a class="headerlink" href="#a-basic-example" title="Permalink to this headline">¶</a></h1>
<p>The first thing you&#8217;ll need is an XML document.  The example programs in this
section will use the <a class="reference download internal" href="_downloads/playlist.xml" download=""><code class="xref download docutils literal"><span class="pre">playlist.xml</span></code></a>
file shown below. This file contains details of five different movies:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;playlist&gt;</span>
  <span class="nt">&lt;movie</span> <span class="na">id=</span><span class="s">&quot;tt0112384&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Apollo 13<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;director&gt;</span>Ron Howard<span class="nt">&lt;/director&gt;</span>
    <span class="nt">&lt;release-date&gt;</span>1995-06-30<span class="nt">&lt;/release-date&gt;</span>
    <span class="nt">&lt;mpaa-rating&gt;</span>PG<span class="nt">&lt;/mpaa-rating&gt;</span>
    <span class="nt">&lt;running-time&gt;</span>140<span class="nt">&lt;/running-time&gt;</span>
    <span class="nt">&lt;genre&gt;</span>adventure<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>drama<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;cast&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Tom Hanks&quot;</span> <span class="na">role=</span><span class="s">&quot;Jim Lovell&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Bill Paxton&quot;</span> <span class="na">role=</span><span class="s">&quot;Fred Haise&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Kevin Bacon&quot;</span> <span class="na">role=</span><span class="s">&quot;Jack Swigert&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Gary Sinise&quot;</span> <span class="na">role=</span><span class="s">&quot;Ken Mattingly&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Ed Harris&quot;</span> <span class="na">role=</span><span class="s">&quot;Gene Kranz&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cast&gt;</span>
    <span class="nt">&lt;imdb-info</span> <span class="na">url=</span><span class="s">&quot;http://www.imdb.com/title/tt0112384/&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;synopsis&gt;</span>
        NASA must devise a strategy to return Apollo 13 to Earth safely
        after the spacecraft undergoes massive internal damage putting
        the lives of the three astronauts on board in jeopardy.
      <span class="nt">&lt;/synopsis&gt;</span>
      <span class="nt">&lt;score&gt;</span>7.6<span class="nt">&lt;/score&gt;</span>
    <span class="nt">&lt;/imdb-info&gt;</span>
  <span class="nt">&lt;/movie&gt;</span>
  <span class="nt">&lt;movie</span> <span class="na">id=</span><span class="s">&quot;tt0307479&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Solaris<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;director&gt;</span>Steven Soderbergh<span class="nt">&lt;/director&gt;</span>
    <span class="nt">&lt;release-date&gt;</span>2002-11-27<span class="nt">&lt;/release-date&gt;</span>
    <span class="nt">&lt;mpaa-rating&gt;</span>PG-13<span class="nt">&lt;/mpaa-rating&gt;</span>
    <span class="nt">&lt;running-time&gt;</span>99<span class="nt">&lt;/running-time&gt;</span>
    <span class="nt">&lt;genre&gt;</span>drama<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>mystery<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>romance<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;cast&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;George Clooney&quot;</span> <span class="na">role=</span><span class="s">&quot;Chris Kelvin&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Natascha McElhone&quot;</span> <span class="na">role=</span><span class="s">&quot;Rheya&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Ulrich Tukur&quot;</span> <span class="na">role=</span><span class="s">&quot;Gibarian&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cast&gt;</span>
    <span class="nt">&lt;imdb-info</span> <span class="na">url=</span><span class="s">&quot;http://www.imdb.com/title/tt0307479/&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;synopsis&gt;</span>
        A troubled psychologist is sent to investigate the crew of an
        isolated research station orbiting a bizarre planet.
      <span class="nt">&lt;/synopsis&gt;</span>
      <span class="nt">&lt;score&gt;</span>6.2<span class="nt">&lt;/score&gt;</span>
    <span class="nt">&lt;/imdb-info&gt;</span>
  <span class="nt">&lt;/movie&gt;</span>
  <span class="nt">&lt;movie</span> <span class="na">id=</span><span class="s">&quot;tt1731141&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ender&#39;s Game<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;director&gt;</span>Gavin Hood<span class="nt">&lt;/director&gt;</span>
    <span class="nt">&lt;release-date&gt;</span>2013-11-01<span class="nt">&lt;/release-date&gt;</span>
    <span class="nt">&lt;mpaa-rating&gt;</span>PG-13<span class="nt">&lt;/mpaa-rating&gt;</span>
    <span class="nt">&lt;running-time&gt;</span>114<span class="nt">&lt;/running-time&gt;</span>
    <span class="nt">&lt;genre&gt;</span>action<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>scifi<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;cast&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Asa Butterfield&quot;</span> <span class="na">role=</span><span class="s">&quot;Ender Wiggin&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Harrison Ford&quot;</span> <span class="na">role=</span><span class="s">&quot;Colonel Graff&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Hailee Steinfeld&quot;</span> <span class="na">role=</span><span class="s">&quot;Petra Arkanian&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cast&gt;</span>
    <span class="nt">&lt;imdb-info</span> <span class="na">url=</span><span class="s">&quot;http://www.imdb.com/title/tt1731141/&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;synopsis&gt;</span>
        Young Ender Wiggin is recruited by the International Military
        to lead the fight against the Formics, a genocidal alien race
        which nearly annihilated the human race in a previous invasion.
      <span class="nt">&lt;/synopsis&gt;</span>
      <span class="nt">&lt;score&gt;</span>6.7<span class="nt">&lt;/score&gt;</span>
    <span class="nt">&lt;/imdb-info&gt;</span>
  <span class="nt">&lt;/movie&gt;</span>
  <span class="nt">&lt;movie</span> <span class="na">id=</span><span class="s">&quot;tt0816692&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Interstellar<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;director&gt;</span>Christopher Nolan<span class="nt">&lt;/director&gt;</span>
    <span class="nt">&lt;release-date&gt;</span>2014-11-07<span class="nt">&lt;/release-date&gt;</span>
    <span class="nt">&lt;mpaa-rating&gt;</span>PG-13<span class="nt">&lt;/mpaa-rating&gt;</span>
    <span class="nt">&lt;running-time&gt;</span>169<span class="nt">&lt;/running-time&gt;</span>
    <span class="nt">&lt;genre&gt;</span>adventure<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>drama<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>scifi<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;cast&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Matthew McConaughey&quot;</span> <span class="na">role=</span><span class="s">&quot;Cooper&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Anne Hathaway&quot;</span> <span class="na">role=</span><span class="s">&quot;Brand&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Jessica Chastain&quot;</span> <span class="na">role=</span><span class="s">&quot;Murph&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Michael Caine&quot;</span> <span class="na">role=</span><span class="s">&quot;Professor Brand&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cast&gt;</span>
    <span class="nt">&lt;imdb-info</span> <span class="na">url=</span><span class="s">&quot;http://www.imdb.com/title/tt0816692/&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;synopsis&gt;</span>
        A team of explorers travel through a wormhole in space in an
        attempt to ensure humanity&#39;s survival.
      <span class="nt">&lt;/synopsis&gt;</span>
      <span class="nt">&lt;score&gt;</span>8.6<span class="nt">&lt;/score&gt;</span>
    <span class="nt">&lt;/imdb-info&gt;</span>
  <span class="nt">&lt;/movie&gt;</span>
  <span class="nt">&lt;movie</span> <span class="na">id=</span><span class="s">&quot;tt3659388&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>The Martian<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;director&gt;</span>Ridley Scott<span class="nt">&lt;/director&gt;</span>
    <span class="nt">&lt;release-date&gt;</span>2015-10-02<span class="nt">&lt;/release-date&gt;</span>
    <span class="nt">&lt;mpaa-rating&gt;</span>PG-13<span class="nt">&lt;/mpaa-rating&gt;</span>
    <span class="nt">&lt;running-time&gt;</span>144<span class="nt">&lt;/running-time&gt;</span>
    <span class="nt">&lt;genre&gt;</span>adventure<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>drama<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;genre&gt;</span>scifi<span class="nt">&lt;/genre&gt;</span>
    <span class="nt">&lt;cast&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Matt Damon&quot;</span> <span class="na">role=</span><span class="s">&quot;Mark Watney&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Jessica Chastain&quot;</span> <span class="na">role=</span><span class="s">&quot;Melissa Lewis&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Kristen Wiig&quot;</span> <span class="na">role=</span><span class="s">&quot;Annie Montrose&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/cast&gt;</span>
    <span class="nt">&lt;imdb-info</span> <span class="na">url=</span><span class="s">&quot;http://www.imdb.com/title/tt3659388/&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;synopsis&gt;</span>
        During a manned mission to Mars, Astronaut Mark Watney is
        presumed dead after a fierce storm and left behind by his crew.
        But Watney has survived and finds himself stranded and alone on
        the hostile planet. With only meager supplies, he must draw upon
        his ingenuity, wit and spirit to subsist and find a way to
        signal to Earth that he is alive.
      <span class="nt">&lt;/synopsis&gt;</span>
      <span class="nt">&lt;score&gt;</span>8.1<span class="nt">&lt;/score&gt;</span>
    <span class="nt">&lt;/imdb-info&gt;</span>
  <span class="nt">&lt;/movie&gt;</span>
<span class="nt">&lt;/playlist&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although this XML document contains details which came from the fabulous
<a class="reference external" href="http://www.imdb.com/">IMDb.com</a> web site, the file structure was created
specifically for this example and does not represent an actual API for
querying movie details.</p>
</div>
<p>Once you have the sample XML document, you can use <a class="reference download internal" href="_downloads/010-list-titles.pl" download=""><code class="xref download docutils literal"><span class="pre">this</span> <span class="pre">script</span></code></a> to extract and print the title of each movie,
in the order they appear in the XML:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="mf">5.010</span><span class="p">;</span>
<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="s">&#39;playlist.xml&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">location</span> <span class="o">=&gt;</span> <span class="nv">$filename</span><span class="p">);</span>

<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$title</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;/playlist/movie/title&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="nv">$title</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and will produce the following output:</p>
<div class="highlight-none"><div class="highlight"><pre>Apollo 13
Solaris
Ender&#39;s Game
Interstellar
The Martian
</pre></div>
</div>
<div class="sidebar">
<p class="first sidebar-title">Is XML::LibXML installed?</p>
<p>If you try running this example script but you don&#8217;t have the
<code class="docutils literal"><span class="pre">XML::LibXML</span></code> module installed on your system, then you&#8217;ll get an error
like this:</p>
<blockquote>
<div>Can&#8217;t locate XML/LibXML.pm in &#64;INC ... at ./010-list-titles.pl line 7.</div></blockquote>
<p class="last">If you do get this error, then refer to <a class="reference internal" href="installation.html"><em>Installing XML::LibXML</em></a> for help on
installing <code class="docutils literal"><span class="pre">XML::LibXML</span></code>.</p>
</div>
<p>If we break the example down line-by-line we see that after a standard
boilerplate section, the script loads the <code class="docutils literal"><span class="pre">XML::LibXML</span></code> module:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">use</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="p">;</span>
</pre></div>
</div>
<p>Next, the <code class="docutils literal"><span class="pre">load_xml()</span></code> class method is called to parse the XML file and
return a document object:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">my</span> <span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">location</span> <span class="o">=&gt;</span> <span class="nv">$filename</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">$dom</span></code> variable now contains an object representing all the elements of
the XML document arranged in a tree structure known as a
<a class="reference internal" href="dom.html"><em>Document Object Model</em></a> or &#8216;DOM&#8217;.</p>
<p>Finally we get to the guts of the script where the <code class="docutils literal"><span class="pre">findnodes()</span></code> method is
called to search the DOM for the elements we&#8217;re interested in and a <code class="docutils literal"><span class="pre">foreach</span></code>
loop is used to iterate through the matching elements:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">foreach</span> <span class="k">my</span> <span class="nv">$title</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;/playlist/movie/title&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="nv">$title</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">findnodes()</span></code> method takes one argument - an <strong>XPath expression</strong>.  This
is a string describing the location and characteristics of the elements we want
to find.  XPath is a query language and the way we use it to select elements
from the DOM is similar to the way we use SQL to select records from a
relational database.  The next section (<a class="reference internal" href="xpath.html"><em>XPath Expressions</em></a>) will include examples of
more complex queries.</p>
<p>The <code class="docutils literal"><span class="pre">findnodes()</span></code> method returns a list of objects from the DOM that match
the XPath expression. Each time through the loop, <code class="docutils literal"><span class="pre">$title</span></code> will contain an
object representing the next matching element.  This object provides a number
of properties and methods that you can use to access the element and its
attributes, as well as any text content and &#8216;child&#8217; elements.</p>
<p>Inside the loop, this example simply calls the <code class="docutils literal"><span class="pre">to_literal()</span></code> method to get
the text content of the element.  The string returned by <code class="docutils literal"><span class="pre">to_literal()</span></code> will
not include any of the attributes but will include the text content of any
child elements.</p>
<div class="section" id="other-xml-sources">
<h2>Other XML sources<a class="headerlink" href="#other-xml-sources" title="Permalink to this headline">¶</a></h2>
<p>The first example script called <code class="docutils literal"><span class="pre">XML::LibXML-&gt;load_xml()</span></code> with the
<code class="docutils literal"><span class="pre">location</span></code> argument set to the name of a file.  The <code class="docutils literal"><span class="pre">location</span></code> argument
also accepts a URL:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">location</span> <span class="o">=&gt;</span> <span class="s">&#39;http://techcrunch.com/feed/&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all versions of <code class="docutils literal"><span class="pre">libxml2</span></code> can retrieve documents over SSL/TLS.  So if
the URL is an &#8216;https&#8217; URL (or if it redirects to one), you may need to use
a module like <a class="reference external" href="https://metacpan.org/release/libwww-perl">LWP</a> to retrieve
the document and pass the response body to the XML parser as a string as
shown below.</p>
</div>
<p>If you have the XML in a string, instead of <code class="docutils literal"><span class="pre">location</span></code>, use <code class="docutils literal"><span class="pre">string</span></code>:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">string</span> <span class="o">=&gt;</span> <span class="nv">$xml_string</span><span class="p">);</span>
</pre></div>
</div>
<p>Or, you can provide a Perl file handle to parse from an  open file or socket,
using <code class="docutils literal"><span class="pre">IO</span></code>:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">IO</span> <span class="o">=&gt;</span> <span class="nv">$fh</span><span class="p">);</span>
</pre></div>
</div>
<p>When providing a string or a file handle, it&#8217;s crucial that you <strong>do not</strong>
decode the bytes of the source data (for example by using <code class="docutils literal"><span class="pre">':utf8'</span></code> when
opening a file).  The underlying <code class="docutils literal"><span class="pre">libxml2</span></code> library is written in C to decode
bytes and does not understand Perl&#8217;s character strings.  If you have assembled
your XML document by concatenating Perl character strings, you will need to
encode it to a byte string (for example using <code class="docutils literal"><span class="pre">Encode::encode_utf8()</span></code>) and
then pass the byte string to the parser.</p>
<p>If you have enabled UTF-8 globally with something like this in your script:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">use</span> <span class="nb">open</span> <span class="s">&#39;:encoding(utf8)&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Then you&#8217;ll need to turn <strong>off</strong> the encoding IO layers for any file handle
that you pass to XML::LibXML:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nb">open</span> <span class="k">my</span> <span class="nv">$fh</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">;</span>
<span class="nb">binmode</span> <span class="nv">$fh</span><span class="p">,</span> <span class="s">&#39;:raw&#39;</span><span class="p">;</span>
<span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">IO</span> <span class="o">=&gt;</span> <span class="nv">$fh</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="a-more-complex-example">
<h2>A more complex example<a class="headerlink" href="#a-more-complex-example" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s look at a slightly more complex example.  <a class="reference download internal" href="_downloads/040-movie-details.pl" download=""><code class="xref download docutils literal"><span class="pre">This</span> <span class="pre">script</span></code></a> takes the same XML input and extracts more
details from each <code class="docutils literal"><span class="pre">&lt;movie&gt;</span></code> element:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="ch">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="mf">5.010</span><span class="p">;</span>
<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="s">&#39;playlist.xml&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dom</span> <span class="o">=</span> <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">location</span> <span class="o">=&gt;</span> <span class="nv">$filename</span><span class="p">);</span>

<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$movie</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;//movie&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="s">&#39;Title:    &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./title&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Director: &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./director&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Rating:   &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./mpaa-rating&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Duration: &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./running-time&#39;</span><span class="p">),</span> <span class="s">&quot; minutes&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="nv">$_</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person/@name&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Starring: &#39;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
    <span class="n">say</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and will produce the following output:</p>
<div class="highlight-none"><div class="highlight"><pre>Title:    Apollo 13
Director: Ron Howard
Rating:   PG
Duration: 140 minutes
Starring: Tom Hanks, Bill Paxton, Kevin Bacon, Gary Sinise, Ed Harris

Title:    Solaris
Director: Steven Soderbergh
Rating:   PG-13
Duration: 99 minutes
Starring: George Clooney, Natascha McElhone, Ulrich Tukur

Title:    Ender&#39;s Game
Director: Gavin Hood
Rating:   PG-13
Duration: 114 minutes
Starring: Asa Butterfield, Harrison Ford, Hailee Steinfeld

Title:    Interstellar
Director: Christopher Nolan
Rating:   PG-13
Duration: 169 minutes
Starring: Matthew McConaughey, Anne Hathaway, Jessica Chastain, Michael Caine

Title:    The Martian
Director: Ridley Scott
Rating:   PG-13
Duration: 144 minutes
Starring: Matt Damon, Jessica Chastain, Kristen Wiig

</pre></div>
</div>
<p>Let&#8217;s compare the main loop of the first script:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">foreach</span> <span class="k">my</span> <span class="nv">$title</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;/playlist/movie/title&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="nv">$title</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>with the main loop of the second script:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="k">foreach</span> <span class="k">my</span> <span class="nv">$movie</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;//movie&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="s">&#39;Title:    &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./title&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Director: &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./director&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Rating:   &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./mpaa-rating&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Duration: &#39;</span><span class="p">,</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./running-time&#39;</span><span class="p">),</span> <span class="s">&quot; minutes&quot;</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="nv">$_</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person/@name&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Starring: &#39;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
    <span class="n">say</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The structure of the main loop is very similar but the XPath expression
passed to <code class="docutils literal"><span class="pre">findnodes()</span></code> is different in each case:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">'/playlist/movie/title'</span></code></dt>
<dd><div class="first line-block">
<div class="line">Will match every <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code> element which is the child of ...</div>
<div class="line">a <code class="docutils literal"><span class="pre">&lt;movie&gt;</span></code> element which is the child of ...</div>
<div class="line">a <code class="docutils literal"><span class="pre">&lt;playlist&gt;</span></code> element which is ...</div>
<div class="line">the top-level element in the document.</div>
</div>
<p class="last">Or, to phrase it a different way, the search will start at the top of the
document and look for a <code class="docutils literal"><span class="pre">&lt;playlist&gt;</span></code> element; if one is found, the search
will continue for child <code class="docutils literal"><span class="pre">&lt;movie&gt;</span></code> elements; and for each one that is
found the search will continue for child <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code> elements.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">'//movie'</span></code></dt>
<dd>Will match every <code class="docutils literal"><span class="pre">&lt;movie&gt;</span></code> element at any level of nesting.</dd>
</dl>
<p>In both cases, the XPath expression starts with a &#8216;/&#8217; which means the search
will start at the the top of the document.</p>
<p>Inside the second script&#8217;s loop are a number of calls to <code class="docutils literal"><span class="pre">findvalue()</span></code>.  This
is a handy shortcut method that is typically used when you expect the XPath
expression to match <em>exactly one node</em>.  It combines the functionality of
<code class="docutils literal"><span class="pre">findnodes()</span></code> and <code class="docutils literal"><span class="pre">to_literal()</span></code> into a single method.  So this code:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findvalue</span><span class="p">(</span><span class="s">&#39;./title&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./title&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
</pre></div>
</div>
<p>There are a couple of other interesting differences with the XPath searches in
the loop compared to previous examples.  Firstly, the <code class="docutils literal"><span class="pre">findvalue()</span></code> method is
being called on <code class="docutils literal"><span class="pre">$movie</span></code> (which represents one <code class="docutils literal"><span class="pre">&lt;movie&gt;</span></code> element) rather
than on <code class="docutils literal"><span class="pre">$dom</span></code> (which represents the whole document). This means that the
<code class="docutils literal"><span class="pre">$movie</span></code> element is the <strong>context element</strong>.  Secondly, the XPath expression
starts with a &#8216;.&#8217; which means: start the search at the context element rather
than at the top of the document.</p>
<p>This second script illustrates a common pattern when working with <code class="docutils literal"><span class="pre">XML::LibXML</span></code>:</p>
<ol class="arabic simple">
<li>find &#8216;interesting&#8217; elements using an XPath query starting with &#8216;/&#8217; or &#8216;//&#8217;</li>
<li>iterate through those elements in a <code class="docutils literal"><span class="pre">foreach</span></code> loop</li>
<li>get additional data from child elements using XPath queries starting with &#8216;.&#8217;</li>
</ol>
</div>
<div class="section" id="accessing-attributes">
<h2>Accessing attributes<a class="headerlink" href="#accessing-attributes" title="Permalink to this headline">¶</a></h2>
<p>When listing cast members in the main loop of the script above, this code ...</p>
<div class="highlight-perl"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="nv">$_</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person/@name&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Starring: &#39;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
</pre></div>
</div>
<p>is used to transform this XML ...</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;cast&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Matt Damon&quot;</span> <span class="na">role=</span><span class="s">&quot;Mark Watney&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Jessica Chastain&quot;</span> <span class="na">role=</span><span class="s">&quot;Melissa Lewis&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;person</span> <span class="na">name=</span><span class="s">&quot;Kristen Wiig&quot;</span> <span class="na">role=</span><span class="s">&quot;Annie Montrose&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/cast&gt;</span>
</pre></div>
</td></tr></table></div>
<p>into this output:</p>
<div class="highlight-none"><div class="highlight"><pre>Starring: Matt Damon, Jessica Chastain, Kristen Wiig
</pre></div>
</div>
<p>In an XPath expression, a name that starts with <code class="docutils literal"><span class="pre">&#64;</span></code> will match an attribute
rather than an element, so <code class="docutils literal"><span class="pre">'person/&#64;name'</span></code> refers to an attribute called
<code class="docutils literal"><span class="pre">name</span></code> on a <code class="docutils literal"><span class="pre">&lt;person&gt;</span></code> element.  In this case, the call to
<code class="docutils literal"><span class="pre">findnodes('./cast/person/&#64;name')</span></code> will return three DOM nodes representing
attribute values which are then transformed into plain strings using
<code class="docutils literal"><span class="pre">to_literal()</span></code>, as we&#8217;ve seen for element nodes, inside a <a class="reference external" href="http://perldoc.perl.org/functions/map.html">map</a> block.</p>
<p>Another approach is to select the <em>element</em> with XPath and then call a DOM
method on the element node to get the attribute value:</p>
<div class="highlight-perl"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="nv">$_</span><span class="o">-&gt;</span><span class="n">getAttribute</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Starring: &#39;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="attributes-via-tied-hash">
<span id="tied-attribute-hash"></span><h2>Attributes via tied hash<a class="headerlink" href="#attributes-via-tied-hash" title="Permalink to this headline">¶</a></h2>
<p>There&#8217;s a shortcut syntax you can use to make this even easier, simply treat
the element node as a hashref:</p>
<div class="highlight-perl"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&#39;, &#39;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="nv">$_</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">name</span><span class="p">};</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&#39;Starring: &#39;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
</pre></div>
</div>
<p>You might be a bit wary of poking around directly inside the element object,
rather than using accessor methods. But don&#8217;t worry, that&#8217;s <strong>not</strong> what this
shortcut syntax is doing.  Instead, every <a class="reference external" href="https://metacpan.org/pod/XML::LibXML::Element">XML::LibXML::Element</a> object returned from the
XPath query has been <a class="reference external" href="https://metacpan.org/pod/distribution/perl/pod/perltie.pod">&#8216;tied&#8217;</a> using
<a class="reference external" href="https://metacpan.org/pod/XML::LibXML::AttributeHash">XML::LibXML::AttributeHash</a> so that hash lookups
&#8216;inside&#8217; the object actually get proxied to <code class="docutils literal"><span class="pre">getAttribute()</span></code> method calls.</p>
<p>This technique is less efficient than calling <code class="docutils literal"><span class="pre">getAttribute()</span></code> directly but
it is very convenient when you want to access more than one attribute of an
element or when you want to interpolate an attribute value into a string:</p>
<div class="highlight-perl"><div class="highlight"><pre>    <span class="k">my</span> <span class="nv">$cast</span> <span class="o">=</span> <span class="nb">join</span> <span class="s">&quot;\n&quot;</span><span class="p">,</span> <span class="nb">map</span> <span class="p">{</span>
        <span class="s">&quot; * $_-&gt;{name} (as $_-&gt;{role})&quot;</span><span class="p">;</span>
    <span class="p">}</span> <span class="nv">$movie</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;./cast/person&#39;</span><span class="p">);</span>
    <span class="n">say</span> <span class="s">&quot;\nStarring:\n&quot;</span><span class="p">,</span> <span class="nv">$cast</span><span class="p">;</span>
</pre></div>
</div>
<p>Which will produce this output:</p>
<div class="highlight-none"><div class="highlight"><pre>Starring:
 * Matt Damon (as Mark Watney)
 * Jessica Chastain (as Melissa Lewis)
 * Kristen Wiig (as Annie Montrose)
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Overloading &#8216;Element&#8217; nodes to support tied hash access to attribute values
was added in version 1.91 of XML::LibXML.  If the examples above don&#8217;t work
for you then it may be because you have a very old version installed.</p>
</div>
</div>
<div class="section" id="parsing-errors">
<h2>Parsing Errors<a class="headerlink" href="#parsing-errors" title="Permalink to this headline">¶</a></h2>
<p>One of the advantages of XML is that it has a few strict rules that every
document must comply with to be considered &#8220;well-formed&#8221;.  If a document is not
well-formed, it should be rejected in its entirety and no part of the XML
document content should be used.  Examples of things that would cause a
document to be not well-formed include:</p>
<ul class="simple">
<li>missing or mismatched closing tag</li>
<li>missing or mismatched quotes around attribute values</li>
<li>whitespace before the initial XML declaration section</li>
<li>byte sequences that do not match the document&#8217;s declared character encoding</li>
<li>any non-whitespace characters after the closing tag for the first top-level
element</li>
</ul>
<p>Like pretty much all XML parser modules, <code class="docutils literal"><span class="pre">libxml</span></code> will throw an exception
if it encounters any violations of these rules.  Since the whole of the XML
document is processed when <code class="docutils literal"><span class="pre">load_xml</span></code> is called, an error at any point in
the document will cause an exception to be raised.</p>
<p>If you wish to handle exceptions gracefully use must use an <code class="docutils literal"><span class="pre">eval</span></code> block or
one of the &#8220;try/catch&#8221; syntax extension modules to catch the error.  For
example, this document contains an error:</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39; standalone=&quot;yes&quot; ?&gt;</span>
<span class="nt">&lt;book</span> <span class="na">edition=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>Training Your Pet Ferret<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;authors&gt;</span>
    <span class="nt">&lt;author&gt;</span>Gerry Bucsis<span class="nt">&lt;/author&gt;</span>
    <span class="nt">&lt;author&gt;</span>Barbara Somerville<span class="nt">&lt;/author&gt;</span>
  <span class="nt">&lt;/authors&gt;</span>
  <span class="nt">&lt;isbn&gt;</span>9780764142239<span class="nt">&lt;/isnb&gt;</span>
  <span class="nt">&lt;dimensions</span> <span class="na">width=</span><span class="s">&quot;162.56mm&quot;</span> <span class="na">height=</span><span class="s">&quot;195.58mm&quot;</span> <span class="na">depth=</span><span class="s">&quot;10.16mm&quot;</span> <span class="na">pages=</span><span class="s">&quot;96&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/book&gt;</span>
</pre></div>
</td></tr></table></div>
<p>This script will attempt to parse the bad input:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="c1">#my $filename = &#39;book.xml&#39;;</span>
<span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="s">&#39;book-borkened.xml&#39;</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dom</span> <span class="o">=</span> <span class="nb">eval</span> <span class="p">{</span>
    <span class="nn">XML::</span><span class="n">LibXML</span><span class="o">-&gt;</span><span class="n">load_xml</span><span class="p">(</span><span class="n">location</span> <span class="o">=&gt;</span> <span class="nv">$filename</span><span class="p">);</span>
<span class="p">};</span>
<span class="k">if</span><span class="p">(</span><span class="vg">$@</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Log failure and exit</span>
    <span class="k">print</span> <span class="s">&quot;Error parsing &#39;$filename&#39;:\n$@&quot;</span><span class="p">;</span>
    <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="k">my</span> <span class="nv">$author</span> <span class="p">(</span><span class="nv">$dom</span><span class="o">-&gt;</span><span class="n">findnodes</span><span class="p">(</span><span class="s">&#39;//author&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">say</span> <span class="nv">$author</span><span class="o">-&gt;</span><span class="n">to_literal</span><span class="p">();</span>
</pre></div>
</div>
<p>and will instead produce this output:</p>
<div class="highlight-none"><div class="highlight"><pre>Error parsing &#39;book-borkened.xml&#39;:
book-borkened.xml:8: parser error : Opening and ending tag mismatch: isbn line 8 and isnb
  &lt;isbn&gt;9780764142239&lt;/isnb&gt;
                            ^
</pre></div>
</div>
<p>Note that although the script is only looking for <code class="docutils literal"><span class="pre">&lt;author&gt;</span></code> elements and the
error in the <code class="docutils literal"><span class="pre">&lt;isbn&gt;</span></code> element comes <em>after</em> all the <code class="docutils literal"><span class="pre">&lt;author&gt;</span></code> elements, an
exception is still raised by the <code class="docutils literal"><span class="pre">load_xml</span></code> call inside the eval block,
before the DOM has been fully constructed.</p>
<p>That&#8217;s it for the basic examples.  The next topic will look more closely at
<a class="reference internal" href="xpath.html"><em>XPath expressions</em></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="xpath.html" class="btn btn-neutral float-right" title="XPath Expressions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Perl XML::LibXML by Example" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Grant McLean.
      Last updated on 2018-06-04.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/plxbe.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>